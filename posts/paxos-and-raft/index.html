<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Paxos and Raft" /><meta name="author" content="hetong07" /><meta property="og:locale" content="en_US" /><meta name="description" content="This is not a complete explanation of the Paxos and the Raft, but just some thoughts about some corner cases." /><meta property="og:description" content="This is not a complete explanation of the Paxos and the Raft, but just some thoughts about some corner cases." /><link rel="canonical" href="https://hetong07.github.io/posts/paxos-and-raft/" /><meta property="og:url" content="https://hetong07.github.io/posts/paxos-and-raft/" /><meta property="og:site_name" content="hetong07" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-05-26T10:42:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Paxos and Raft" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@hetong07" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"This is not a complete explanation of the Paxos and the Raft, but just some thoughts about some corner cases.","url":"https://hetong07.github.io/posts/paxos-and-raft/","@type":"BlogPosting","headline":"Paxos and Raft","dateModified":"2020-05-26T10:42:00+08:00","datePublished":"2020-05-26T10:42:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://hetong07.github.io/posts/paxos-and-raft/"},"author":{"@type":"Person","name":"hetong07"},"@context":"https://schema.org"}</script><title>Paxos and Raft | hetong07</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">hetong07</a></div><div class="site-subtitle font-italic">Personal reading posts</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/hetong07" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hetong07','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Paxos and Raft</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Paxos and Raft</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, May 26, 2020, 10:42 AM +0800" > May 26, 2020 <i class="unloaded">2020-05-26T10:42:00+08:00</i> </span> by <span class="author"> hetong07 </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="536 words">2 min</span></div></div><div class="post-content"><p>This is not a complete explanation of the Paxos and the Raft, but just some thoughts about some corner cases.</p><h3 id="livelock-and-leader-in-the-paxos">Livelock and leader in the Paxos</h3><p>The basic paxos algorith works well but has a <strong>livelock</strong> issue: two proposers may each grow the instance number to infinite but no one can proceed. To solve this problem, the author proposes the notion of <strong>distinctive</strong> proposer, which acts as the leader to initiate all the propose. But it does not present how to select such leader. According to the [3], the usually used leader election algorithm is Bully algorithm:</p><blockquote><p>A node that starts an election sends its server ID to all of its peers. If it gets a response from any peer with a higher ID, it will not be the leader. If all responses have lower IDs than it becomes the leader. If a node receives an election message from a node with a lower-numbered ID, then the node starts its own election. Eventually, the node with the highest ID will be the winner.</p></blockquote><p>which is much like the one used in the Paxos.</p><p>Since there is a leader, I suspect that unless there was a proposer failure, the proposal returned by acceptors (if any) will be the same.</p><p>Also, this issue can be solved via exponential backoff, but it will rise the latency.</p><h3 id="history-confilct">History confilct</h3><p>The basic paxos works well if there is no network issue underlying. For example, assuming there are five servers/processes {A, B, C, D, E}, and there is a network partition and divides the servers into three group {A, B}, {C}, {D, E}. If {A ,B} is about to commit value “(1, Foo)” while {D, E} is about to commit “(2, Bar)”, the final result will be determined by C:</p><ul><li>if C joins {A ,B}, “Foo” will be committed<li>if C stands with {D, E}, “Bar” will be committed At first glance, it seems no harm, but consider then the servers are all down, which history is the history? The servers diverge with two different history. (Refer to “Conflict Resolution Example” in [2] for detials).</ul><p>Paxos seems has no solution to this, and according to [2], ths naive way to solve this is to let the application itself to poll history from peers to make up the inconsistency.</p><p>While on the contratry, Raft solves this problem via:</p><ul><li>master is the ultimate arbiter of the history, and it can rewrite conflict history.<li><strong>new</strong> master is not allowed to commit old round values (I cannot remember clearly)</ul><p>I think this is one of the case why Raft is more easy to understand than Paxos.</p><p>I guess this problem can be solve by the <em>catchup</em> mechanism described in [5], it is exactly achieved by the application layer.</p><h3 id="multi-paxos">Multi-Paxos</h3><p>The Multi-Paxos works much like the Raft.</p><h3 id="some-notions-about-paxos">Some notions about Paxos</h3><p>Each round of Paxos is like a transacion, <em>acceptors</em> will noly reply the proposal received in this round, this is where I struggled to understand at first.</p><h3 id="raft-implementation">Raft implementation</h3><p>I have implemented the mit 6.824 (2019) version of Raft in https://github.com/hetong07/mit6.824. The final lab is left not finished, but it should be very easy.</p><h2 id="reference">Reference</h2><ol><li><a href="https://lamport.azurewebsites.net/pubs/paxos-simple.pdf">Paxos made simple</a><li><a href="https://understandingpaxos.wordpress.com/">Understanding Paxos</a><li><a href="https://www.cs.rutgers.edu/~pxk/417/notes/paxos.html">Understanding Paxos</a><li><a href="https://raft.github.io/raft.pdf">Raft</a><li><a href="https://dl.acm.org/doi/pdf/10.1145/1281100.1281103">Paxos made live</a></ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/technical/'>Technical</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/paxos/" class="post-tag no-text-decoration" >paxos</a> <a href="/tags/raft/" class="post-tag no-text-decoration" >raft</a> <a href="/tags/distributed-system/" class="post-tag no-text-decoration" >distributed system</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Paxos and Raft - hetong07&url=https://hetong07.github.io/posts/paxos-and-raft/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Paxos and Raft - hetong07&u=https://hetong07.github.io/posts/paxos-and-raft/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Paxos and Raft - hetong07&url=https://hetong07.github.io/posts/paxos-and-raft/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/GPU-Scheduling/">GPU Scheduling for ML workload</a><li><a href="/posts/caladan/">Caladan interference mitigation</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/distributed-system/">distributed system</a> <a class="post-tag" href="/tags/paxos/">paxos</a> <a class="post-tag" href="/tags/raft/">raft</a> <a class="post-tag" href="/tags/gpu/">GPU</a> <a class="post-tag" href="/tags/interference-mitigation/">interference mitigation</a> <a class="post-tag" href="/tags/kv-store/">KV store</a> <a class="post-tag" href="/tags/leveldb/">leveldb</a> <a class="post-tag" href="/tags/ml-sys/">ML Sys</a> <a class="post-tag" href="/tags/rsm/">RSM</a> <a class="post-tag" href="/tags/scheduling/">scheduling</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Paxos-RSM/"><div class="card-body"> <span class="timeago small" > May 28, 2020 <i class="unloaded">2020-05-28T06:09:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Paxos RSM</h3><div class="text-muted small"><p> Replicated State Machine (RSM) [1] talks about the theory of RSM. The core idea if the RSM is straightforward: replicate the state machine (SM) on different processes/servers, and as lone as the in...</p></div></div></a></div><div class="card"> <a href="/posts/Basic-Understanding-of-LevelDB/"><div class="card-body"> <span class="timeago small" > Jun 7, 2020 <i class="unloaded">2020-06-07T14:22:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Basic Understanding of LevelDB</h3><div class="text-muted small"><p> LevelDB is the open-sourced Google BigTable implementaion, and its coding style is nice for amateurs to follow. This post presents my understands of the LevelDB and some details of its implementaio...</p></div></div></a></div><div class="card"> <a href="/posts/caladan/"><div class="card-body"> <span class="timeago small" > Jan 15 <i class="unloaded">2021-01-15T07:35:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Caladan interference mitigation</h3><div class="text-muted small"><p> Caladan interference mitigation People are always focus how to schedule tasks within a cluster or across cluster, but less focus on scheduling tasks within a machine, because we usually think the ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled"><p>-</p></span> <a href="/posts/Paxos-RSM/" class="btn btn-outline-primary"><p>Paxos RSM</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/username">hetong07</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/distributed-system/">distributed system</a> <a class="post-tag" href="/tags/paxos/">paxos</a> <a class="post-tag" href="/tags/raft/">raft</a> <a class="post-tag" href="/tags/gpu/">GPU</a> <a class="post-tag" href="/tags/interference-mitigation/">interference mitigation</a> <a class="post-tag" href="/tags/kv-store/">KV store</a> <a class="post-tag" href="/tags/leveldb/">leveldb</a> <a class="post-tag" href="/tags/ml-sys/">ML Sys</a> <a class="post-tag" href="/tags/rsm/">RSM</a> <a class="post-tag" href="/tags/scheduling/">scheduling</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://hetong07.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
